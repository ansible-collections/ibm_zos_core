# Copyright (c) IBM Corporation 2023, 2025
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#     http://www.apache.org/licenses/LICENSE-2.0
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

DOCUMENTATION = r'''
---
module: playbook_upgrade_validator
version_added: "1.0.0"
author:
  - "Ravella Surendra Babu (@surendrababuravella)"
short_description: Validates playbooks against ibm_zos_core 2.0 and provides migration actions.
description:
  - Scans one or more Ansible playbooks to identify deprecated or renamed parameters
    based on migration rules for IBM z/OS core collection version 2.0.
  - Provides line numbers, affected modules, and suggested corrective actions.
options:
  ignore_response_params:
    description:
      - Indicates whether information about response parameter changes should be included.
    default: false
    type: bool
  migration_map:
    description:
      - A structured set of migration rules that specifies deprecated, renamed, and modified parameters
        to help upgrade playbooks from ibm_zos_core 1.x to 2.0.
    required: true
    type: dict
  output_path:
    description:
      - File path where validation results should be written in JSON format.
    required: true
    type: str
  playbook_path:
    description:
      - The path to the directory containing one or more Ansible playbooks.
    required: true
    type: str
notes:
  - Designed to assist migration of playbooks from older IBM z/OS core collection versions to 2.0.
  - Supports reading tasks, blocks, and nested includes.
'''

EXAMPLES = r'''
- name: execute playbook_upgrade_validator role
  include_role:
    name: ibm.ibm_zos_core.playbook_upgrade_validator
  vars:
    playbook_path: "/path/to/playbooks/*.yml"
    output_path: "/path/to/reports/validation_report.json"
    ignore_response_params: false
'''

RETURN = r'''
changed:
  description:
    - Always false as there is no state changes happen in this process.
  returned: always
  type: bool
output_path:
  description: File path where validation results should be written in JSON format.
  returned: always
  type: str
playbook_path:
  description: The path to the directory containing one or more Ansible playbooks.
  returned: always
  type: str
results:
  description: List of issues identified in all scanned playbooks, along with detailed information.
  returned: always
  type: list
  sample:
    [
        {
            "line": 9,
            "migration_actions": [
                "[MUST_FIX] Param 'force_lock' is renamed to 'force' in zos_copy",
                "[MUST_FIX] Param 'is_binary' is renamed to 'binary' in zos_copy",
                "[MUST_FIX] Param 'force' is renamed to 'replace' in zos_copy"
            ],
            "module": "zos_copy",
            "play_name": "Execute z/OS modules",
            "playbook": "/path/to/playbook/copy_file.yml",
            "task_name": "copy file to z/os"
        }
    ]
'''